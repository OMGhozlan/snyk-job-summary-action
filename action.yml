name: 'Snyk Job Summary Action'
description: 'Add a Job Summary from Snyk reports, also uploads HTML reports to Github Packages'

inputs:
 DependenciesReportPath:
   description: 'json file path generated by snyk test command'
   required: false
   default: snyk_dependencies.json
 CodeReportPath:
   description: 'json file path generated by snyk code test command'
   required: false
   default: snyk_code.json

runs:
  using: composite

  steps:
    - uses: actions/setup-node@v4

      shell: bash
    - run: npm install snyk-to-html --location=global

    - name: convert Snyk Dependencies json to html format
      shell: bash
      run: snyk-to-html -i ${{inputs.DependenciesReportPath}} -o snyk_dependencies.html

    - name: convert Snyk Code json to html format
      shell: bash
      run: snyk-to-html -i ${{inputs.CodeReportPath}} -o snyk_code.html

    - run: pip install mdutils
      shell: bash
      name: install mdutils

    - name: Run script
      shell: bash
      run: python ${{ github.action_path }}/job_summary.py ${{inputs.DependenciesReportPath}} ${{inputs.CodeReportPath}} 

    - name: Add output to Job Summary
      run: cat vulnerabilities.md >> $GITHUB_STEP_SUMMARY
      shell: bash
