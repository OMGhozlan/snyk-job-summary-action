name: 'Snyk Job Summary Action'
description: 'Add a Job Summary from Snyk reports, also uploads HTML reports to Github Packages'

inputs:
 dependencies-report-path:
   description: 'json file path generated by snyk test command'
   required: false
   default: snyk_dependencies.json
 code-report-path:
   description: 'json file path generated by snyk code test command'
   required: false
   default: snyk_code.json


runs:
  using: composite

  steps:
    - uses: actions/setup-node@v4

    - run: npm install snyk-to-html --location=global
      shell: bash

    - name: convert Snyk Dependencies json to html format
      run: snyk-to-html -i ${{inputs.DependenciesReportPath}} -o snyk_dependencies.html
      shell: bash

    - name: convert Snyk Code json to html format
      run: snyk-to-html -i ${{inputs.CodeReportPath}} -o snyk_code.html
      shell: bash

    - run: pip install mdutils
      name: install mdutils
      shell: bash

    - name: Run script
      run: python ${{ github.action_path }}/job_summary.py ${{inputs.DependenciesReportPath}} ${{inputs.CodeReportPath}} 
      shell: bash

    - name: Add output to Job Summary
      run: cat vulnerabilities.md >> $GITHUB_STEP_SUMMARY
      shell: bash
